<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>AdultChat API Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #111;
      color: #f5f5f5;
      padding: 1.5rem;
    }
    .card {
      background: #1b1b1f;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid rgba(255,255,255,0.08);
    }
    input {
      padding: 0.3rem 0.5rem;
      border-radius: 6px;
      border: 1px solid #444;
      background: #222;
      color: #f5f5f5;
    }
    button {
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      border: none;
      background: #7b0022;
      color: #fff;
      cursor: pointer;
      margin-top: 0.4rem;
    }
    button:hover {
      background: #a10030;
    }
    pre {
      background: #000;
      padding: 0.6rem;
      border-radius: 8px;
      max-height: 300px;
      overflow: auto;
      font-size: 0.8rem;
    }
    label {
      font-size: 0.85rem;
      display: inline-block;
      margin-top: 0.2rem;
    }
    .row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .card-half {
      flex: 1 1 260px;
    }
  </style>
</head>
<body>
  <h1>AdultChat API Test</h1>
  <p>Backend: <code>http://localhost:4000</code></p>

  <div class="row">
    <div class="card card-half">
      <h2>Client registrieren</h2>
      <label>
        E-Mail:
        <input id="client-email" type="email" value="client@test.com" />
      </label>
      <br />
      <label>
        Passwort:
        <input id="client-password" type="password" value="1234" />
      </label>
      <br />
      <button id="btn-register-client">Client registrieren</button>
    </div>

    <div class="card card-half">
      <h2>Model registrieren</h2>
      <label>
        E-Mail:
        <input id="model-email" type="email" value="model@test.com" />
      </label>
      <br />
      <label>
        Passwort:
        <input id="model-password" type="password" value="abcd" />
      </label>
      <br />
      <button id="btn-register-model">Model registrieren</button>
    </div>
  </div>

  <div class="card">
    <h2>User-Liste anzeigen</h2>
    <button id="btn-load-users">Alle Users laden</button>
  </div>

  <div class="row">
    <div class="card card-half">
      <h2>Nachricht senden (mit Token-Abzug)</h2>
      <label>
        fromUserId (z.B. Client-ID):
        <input id="msg-from" type="number" />
      </label>
      <br />
      <label>
        toUserId (z.B. Model-ID):
        <input id="msg-to" type="number" />
      </label>
      <br />
      <label>
        Text:
        <input id="msg-text" type="text" value="Hi ðŸ˜ˆ" style="width: 100%;" />
      </label>
      <br />
      <label>
        Kosten (Tokens, optional â€“ leer = 2):
        <input id="msg-cost" type="number" />
      </label>
      <br />
      <button id="btn-send-message">Nachricht senden</button>
    </div>

    <div class="card card-half">
      <h2>Verlauf laden</h2>
      <label>
        userId:
        <input id="conv-user" type="number" />
      </label>
      <br />
      <label>
        partnerId:
        <input id="conv-partner" type="number" />
      </label>
      <br />
      <button id="btn-load-conversation">Verlauf laden</button>
    </div>
  </div>

  <div class="card">
    <h2>Antwort</h2>
    <pre id="output">Noch keine Anfrage gesendet.</pre>
  </div>

  <script>
    const API_BASE = "http://localhost:4000";

    const output = document.getElementById("output");
    const btnRegisterClient = document.getElementById("btn-register-client");
    const btnRegisterModel = document.getElementById("btn-register-model");
    const btnLoadUsers = document.getElementById("btn-load-users");
    const btnSendMessage = document.getElementById("btn-send-message");
    const btnLoadConversation = document.getElementById("btn-load-conversation");

    function showResult(data) {
      output.textContent = JSON.stringify(data, null, 2);
    }

    function showError(err) {
      output.textContent = "FEHLER:\n" + err;
    }

    // Client registrieren
    if (btnRegisterClient) {
      btnRegisterClient.addEventListener("click", async () => {
        const email = document.getElementById("client-email").value;
        const password = document.getElementById("client-password").value;

        try {
          const res = await fetch(API_BASE + "/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password, role: "client" }),
          });
          const data = await res.json();
          showResult(data);
        } catch (err) {
          showError(err);
        }
      });
    }

    // Model registrieren
    if (btnRegisterModel) {
      btnRegisterModel.addEventListener("click", async () => {
        const email = document.getElementById("model-email").value;
        const password = document.getElementById("model-password").value;

        try {
          const res = await fetch(API_BASE + "/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password, role: "model" }),
          });
          const data = await res.json();
          showResult(data);
        } catch (err) {
          showError(err);
        }
      });
    }

    // Alle User laden
    if (btnLoadUsers) {
      btnLoadUsers.addEventListener("click", async () => {
        try {
          const res = await fetch(API_BASE + "/api/users");
          const data = await res.json();
          showResult(data);
        } catch (err) {
          showError(err);
        }
      });
    }

    // Nachricht senden
    if (btnSendMessage) {
      btnSendMessage.addEventListener("click", async () => {
        const fromUserId = Number(document.getElementById("msg-from").value);
        const toUserId = Number(document.getElementById("msg-to").value);
        const text = document.getElementById("msg-text").value;
        const costRaw = document.getElementById("msg-cost").value;
        const cost = costRaw === "" ? undefined : Number(costRaw);

        try {
          const res = await fetch(API_BASE + "/api/messages/send", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ fromUserId, toUserId, text, cost }),
          });
          const data = await res.json();
          showResult(data);
        } catch (err) {
          showError(err);
        }
      });
    }

    // Verlauf laden
    if (btnLoadConversation) {
      btnLoadConversation.addEventListener("click", async () => {
        const userId = document.getElementById("conv-user").value;
        const partnerId = document.getElementById("conv-partner").value;

        try {
          const res = await fetch(
            API_BASE + "/api/messages?userId=" + userId + "&partnerId=" + partnerId
          );
          const data = await res.json();
          showResult(data);
        } catch (err) {
          showError(err);
        }
      });
    }
  </script>
</body>
</html>
